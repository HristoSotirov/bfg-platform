/accreditations:
  get:
    tags:
      - Accreditations
    summary: Get all accreditations
    operationId: getAllAccreditations
    parameters:
      - name: filter
        in: query
        description: |
          Filter expression. Supports expanded fields with dot notation, range operator, and in operator.

          **Available Fields:**
          - `athleteId`, `clubId` (UUID)
          - `year` or `accreditationYear`
          - `status` or `accreditationStatus`
          - `accreditationNumber`
          - `createdAt`
          
          **Expanded Fields (requires expand parameter):**
          - `athlete.dateOfBirth`, `athlete.firstName`, `athlete.lastName`, `athlete.gender`
          - `club.name`, `club.shortName`, `club.isActive`
          
          **Operators:**
          - Comparison: `eq`, `ne`, `gt`, `ge`, `lt`, `le`
          - Range: `field range 'min' to 'max'` (inclusive), `field range 'min' to ''` (after min), `field range '' to 'max'` (before max)
          - In: `field in ('value1', 'value2', 'value3')`
          
          **Examples:**
          - `clubId eq 'xxx' and year eq 2025`
          - `athlete.dateOfBirth range '2002-01-01' to '2010-01-01'` (requires expand=athlete)
          - `athlete.dateOfBirth range '2002-01-01' to ''` (after date, requires expand=athlete)
          - `status in ('ACTIVE', 'PENDING')`
          - `clubId in ('uuid1', 'uuid2', 'uuid3')`
          - `club.name eq 'RC Sofia'` (requires expand=club)
        schema:
          type: string
      - name: search
        in: query
        required: false
        description: |
          Free-text search across athlete names/date of birth, club name, and accreditation number (case-insensitive).

          **Behavior:**
          - Tokenized by whitespace.
          - All tokens must match at least one field (AND across tokens).

          **Matches:**
          - athlete `firstName`, `middleName`, `lastName`
          - athlete `dateOfBirth` when a token is a date (yyyy-MM-dd)
          - club `name`
          - `accreditationNumber`

          **Examples:**
          - `Ivanov 1990-01-15 RC Sofia 000123`
        schema:
          type: string
      - name: orderBy
        in: query
        description: |
          Sort fields (multiselect). Supports expanded fields with dot notation.
          
          **Available Sorts:**
          - `year_asc`, `year_desc`
          - `accreditationNumber_asc`, `accreditationNumber_desc`
          - `createdAt_asc`, `createdAt_desc`
          
          **Expanded Field Sorts (requires expand parameter):**
          - `athlete.dateOfBirth_asc`, `athlete.dateOfBirth_desc`
          - `athlete.firstName_asc`, `athlete.firstName_desc`
          - `athlete.lastName_asc`, `athlete.lastName_desc`
          - `club.name_asc`, `club.name_desc`
          
          **Examples:**
          - `athlete.dateOfBirth_asc` (requires expand=athlete)
          - `club.name_asc, year_desc` (requires expand=club)
          
          **Note:** Conflicting sorts (e.g., `name_asc,name_desc`) are not allowed.
        style: form
        explode: true
        schema:
          type: array
          items:
            type: string
          default: ["year_desc"]
      - name: top
        in: query
        description: Maximum number of items to return
        schema:
          type: integer
          minimum: 1
          maximum: 1000
          default: 100
      - name: skip
        in: query
        description: Number of items to skip
        schema:
          type: integer
          minimum: 0
          default: 0
      - name: expand
        in: query
        description: |
          Fields to expand (multiselect).
          Available options: athlete, club
          
          When expanded, the full entity objects are included in the response.
          Expanded fields can also be used in filter and sort expressions using dot notation.
        style: form
        explode: true
        schema:
          type: array
          items:
            type: string
            enum:
              - athlete
              - club
          example: ["athlete", "club"]
    responses:
      "200":
        description: List of accreditations retrieved
        content:
          application/json:
            schema:
              allOf:
                - $ref: "../common/schemas.yaml#/Page"
                - type: object
                  properties:
                    content:
                      type: array
                      items:
                        $ref: "../accreditations/schemas.yaml#/AccreditationDto"
      "400":
        description: Bad request - validation error
        content:
          application/json:
            schema:
              $ref: "../common/schemas.yaml#/ErrorResponse"


/accreditations/renew/{athleteId}:
  post:
    tags:
      - Accreditations
    summary: Renew accreditation for an athlete
    description: Renews accreditation for the current year. Uses the same card number if the athlete already has an accreditation for this club, otherwise generates a new one. Club ID is taken from the current user's context.
    operationId: renewAccreditation
    parameters:
      - name: athleteId
        in: path
        required: true
        description: UUID of the athlete
        schema:
          type: string
          format: uuid
        x-parameter-extra-annotation: '@NotNull(message = "{athlete.uuid.required}")'
    responses:
      "201":
        description: Accreditation renewed successfully
        content:
          application/json:
            schema:
              $ref: "../accreditations/schemas.yaml#/AccreditationDto"
      "400":
        description: Bad request - validation error
        content:
          application/json:
            schema:
              $ref: "../common/schemas.yaml#/ErrorResponse"
      "409":
        description: Conflict - accreditation for this year already exists
        content:
          application/json:
            schema:
              $ref: "../common/schemas.yaml#/ErrorResponse"

/accreditations/migrate:
  post:
    tags:
      - Accreditations
    summary: Batch migrate athletes from old card number format
    operationId: batchMigrateAthletes
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../athletes/schemas.yaml#/AthleteBatchMigrationRequest"
    responses:
      "200":
        description: Migration completed (some athletes may have been skipped)
        content:
          application/json:
            schema:
              $ref: "../athletes/schemas.yaml#/AthleteBatchMigrationResponse"
      "400":
        description: Bad request - validation error
        content:
          application/json:
            schema:
              $ref: "../common/schemas.yaml#/ErrorResponse"

/accreditations/{accreditationUuid}:
  parameters:
    - name: accreditationUuid
      in: path
      required: true
      description: UUID of the accreditation
      schema:
        type: string
        format: uuid
      x-parameter-extra-annotation: '@NotNull(message = "{accreditation.uuid.required}")'

  get:
    tags:
      - Accreditations
    summary: Get accreditation by UUID
    operationId: getAccreditationByUuid
    parameters:
      - name: expand
        in: query
        description: |
          Fields to expand (multiselect).
          Available options: athlete, club
          
          When expanded, the full entity objects are included in the response.
        style: form
        explode: true
        schema:
          type: array
          items:
            type: string
            enum:
              - athlete
              - club
          example: ["athlete", "club"]
    responses:
      "200":
        description: Accreditation details retrieved
        content:
          application/json:
            schema:
              $ref: "../accreditations/schemas.yaml#/AccreditationDto"
      "404":
        description: Accreditation not found
        content:
          application/json:
            schema:
              $ref: "../common/schemas.yaml#/ErrorResponse"

  patch:
    tags:
      - Accreditations
    summary: Update accreditation status
    description: Updates only the status of an accreditation. Only FEDERATION_ADMIN and APP_ADMIN can update accreditation status.
    operationId: patchAccreditationStatus
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../accreditations/schemas.yaml#/AccreditationStatus"
          x-request-body-extra-annotation: '@NotNull(message = "{accreditation.status.required}")'
    responses:
      "200":
        description: Accreditation status updated successfully
        content:
          application/json:
            schema:
              $ref: "../accreditations/schemas.yaml#/AccreditationDto"
      "400":
        description: Bad request - validation error (status is required)
        content:
          application/json:
            schema:
              $ref: "../common/schemas.yaml#/ErrorResponse"
      "404":
        description: Accreditation not found
        content:
          application/json:
            schema:
              $ref: "../common/schemas.yaml#/ErrorResponse"

